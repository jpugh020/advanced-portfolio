<!-- Blog Header -->
<div class="blog-header bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 text-white py-16">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center">
      <h1 class="text-4xl md:text-6xl font-bold mb-6 text-white leading-tight pt-[1.5%]">
        Blog
      </h1>
      <p class="text-xl md:text-2xl text-blue-100 max-w-3xl mx-auto mb-6">
        Follow my journey with new frameworks and technologies as well as my learning and experience with things such as landscaping and construction
      </p>
      
      <!-- Cache Status Indicator -->
      <div class="flex items-center justify-center gap-2 text-sm text-blue-100">
        <mat-icon [matTooltip]="getCacheStatusText()" class="text-blue-100">{{ getCacheStatusIcon() }}</mat-icon>
        <span *ngIf="isUsingCache()" class="text-blue-100">
          {{ getCacheStatusText() }}
        </span>
        <button mat-icon-button *ngIf="isUsingCache()"
          (click)="forceRefresh()"
          matTooltip="Refresh data"
          class="text-blue-100 hover:text-white">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  
  <!-- Search and Filter Section -->
  <div class="mb-8  rounded-lg shadow-sm border border-gray-200 p-6">
    <div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between">
      
      <!-- Search Input -->
      <div class="flex-1 max-w-md">
        <mat-form-field appearance="fill" class="w-full search-field">
          <mat-label>Search articles...</mat-label>
          <input
            matInput
            [value]="searchQuery()"
            (input)="onSearchInput($event)"
            placeholder="Enter keywords"
          />
          <mat-icon matPrefix>search</mat-icon>
          @if (searchQuery()) {
            <button
              mat-icon-button
              matSuffix
              (click)="clearSearch()"
              aria-label="Clear search"
            >
              <mat-icon>close</mat-icon>
            </button>
          }
        </mat-form-field>
      </div>

      <!-- Active Filters Display -->
      <div class="flex flex-wrap gap-2 items-center">
        @if (searchQuery()) {
          <mat-chip-set>
            <mat-chip (removed)="clearSearch()">
              Search: "{{ searchQuery() }}"
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-set>
        }
        @if (selectedTag()) {
          <mat-chip-set>
            <mat-chip (removed)="clearTagFilter()">
              Tag: {{ selectedTag() }}
              <mat-icon matChipRemove>cancel</mat-icon>
            </mat-chip>
          </mat-chip-set>
        }
      </div>
    </div>

    <!-- Tags Filter -->
    @if (availableTags().length > 0) {
      <mat-divider class="my-4"></mat-divider>
      <div>
        <h3 class="text-sm font-medium text-gray-700 mb-3">Filter by tags:</h3>
        <div class="flex flex-wrap gap-2">
          @for (tag of availableTags(); track tag) {
            <mat-chip-set>
              <mat-chip
                [class.mat-mdc-chip-selected]="selectedTag() === tag"
                (click)="filterByTag(tag)"
                class="cursor-pointer hover:shadow-md transition-shadow duration-200"
              >
                {{ tag }}
              </mat-chip>
            </mat-chip-set>
          }
        </div>
      </div>
    }
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex justify-center items-center py-16">
      <mat-spinner diameter="50"></mat-spinner>
    </div>
  }

  <!-- Blog Posts Grid -->
  @if (!isLoading() && hasResults()) {
    <div class="grid gap-8 md:gap-12">
      @for (post of posts(); track trackBySlug($index, post)) {
        <article 
          class=" rounded-xl shadow-sm  overflow-hidden hover:shadow-lg transition-shadow duration-300 cursor-pointer group"
          (click)="navigateToPost(post)"
        >
          <div class="md:flex">
            
            <!-- Post Image -->
            @if (post.imageurl) {
              <div class="md:w-1/3 lg:w-2/5">
                <div class="aspect-video md:aspect-square md:h-full overflow-hidden">
                  <img
                    [src]="post.imageurl"
                    [alt]="post.title"
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                    loading="lazy"
                  />
                </div>
              </div>
            }

            <!-- Post Content -->
            <div class="p-6 md:p-8 flex-1">
              <div class="flex flex-col h-full">
                
                <!-- Post Meta -->
                <div class="flex items-center gap-4 text-sm text-gray-600 mb-4">
                  <div class="flex items-center gap-1">
                    <mat-icon class="text-base">person</mat-icon>
                    <span>{{ post.author }}</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <mat-icon class="text-base">calendar_today</mat-icon>
                    <span>{{ formatDate(post.publisheddate.toString()) }}</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <mat-icon class="text-base">schedule</mat-icon>
                    <span>{{ getReadingTime(post.readtime) }}</span>
                  </div>
                </div>

                <!-- Post Title -->
                <h2 class="text-xl md:text-2xl font-bold  mb-3 group-hover:text-indigo-600 transition-colors duration-200 line-clamp-2">
                  {{ post.title }}
                </h2>

                <!-- Post Excerpt -->
                <p class="text-gray-600 text-base leading-relaxed mb-4 flex-1 line-clamp-3">
                  {{ post.excerpt }}
                </p>

                <!-- Tags and Read More -->
                <div class="flex items-center justify-between">
                  <!-- Tags -->
                  <div class="flex flex-wrap gap-2">
                    @for (tag of post.tags; track tag) {
                      <span
                        class="inline-block px-3 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded-full hover:bg-indigo-100 hover:text-indigo-700 transition-colors duration-200 cursor-pointer"
                        (click)="filterByTag(tag); $event.stopPropagation()"
                        [matTooltip]="'Filter by ' + tag"
                      >
                        {{ tag }}
                      </span>
                    }
                  </div>

                  <!-- Read More Button -->
                  <button
                    mat-stroked-button
                    color="primary"
                    class="ml-4 flex-shrink-0"
                    (click)="navigateToPost(post); $event.stopPropagation()"
                  >
                    Read More
                    <mat-icon style="font-family: Material Icons;">arrow_forward</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </article>
      }
    </div>

    <!-- Pagination -->
    @if (showPagination()) {
      <div class="mt-12 flex justify-center">
        <mat-paginator
          [length]="totalCount()"
          [pageSize]="pageSize"
          [pageIndex]="currentPage() - 1"
          [pageSizeOptions]="[5, 10, 25]"
          (page)="onPageChange($event)"
          showFirstLastButtons
          class="bg-white rounded-lg shadow-sm border border-gray-200"
        >
        </mat-paginator>
      </div>
    }
  }

  <!-- No Results State -->
  @if (!isLoading() && !hasResults()) {
    <div class="text-center py-16">
      <mat-icon class="text-6xl text-gray-300 mb-4">search_off</mat-icon>
      <h3 class="text-xl font-semibold text-gray-700 mb-2">No articles found</h3>
      <p class="text-gray-500 mb-6">
        @if (searchQuery() || selectedTag()) {
          Try adjusting your search or filter criteria.
        } @else {
          No blog posts are available at the moment.
        }
      </p>
      @if (searchQuery() || selectedTag()) {
        <button
          mat-raised-button
          color="primary"
          (click)="clearSearch(); clearTagFilter()"
        >
          Clear Filters
        </button>
      }
    </div>
  }

</div>

<!-- Additional Styling for line-clamp utility classes -->
<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>