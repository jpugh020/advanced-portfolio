<!-- Loading State -->
    @if (isLoading()) {
      <div class="min-h-screen flex items-center justify-center">
        <mat-spinner diameter="50"></mat-spinner>
      </div>
    }

    <!-- Post Not Found -->
    @if (!isLoading() && !post()) {
      <div class="min-h-screen flex items-center justify-center">
        <div class="text-center py-16 px-4">
          <mat-icon class="text-6xl text-gray-300 mb-4">article</mat-icon>
          <h1 class="text-2xl font-bold text-gray-700 mb-4">Post Not Found</h1>
          <p class="text-gray-500 mb-6">The blog post you're looking for doesn't exist or has been moved.</p>
          <button
            mat-raised-button
            color="primary"
            routerLink="/blog"
          >
            <mat-icon>arrow_back</mat-icon>
            Back to Blog
          </button>
        </div>
      </div>
    }

    <!-- Blog Post Content -->
    @if (!isLoading() && post()) {
      <!-- Hero Section -->
      <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 text-white">
        @if (post()!.imageurl) {
          <div class="relative">
            <div class="absolute inset-0 bg-black/50"></div>
            <img
              [src]="post()!.imageurl"
              [alt]="post()!.title"
              class="w-full h-96 object-cover"
            />
            <div class="absolute inset-0 flex items-end">
              <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pb-8">
                <div class="w-full">
                  <!-- Breadcrumb -->
                  <nav class="mb-4">
                    <button
                      mat-button
                      routerLink="/blog"
                      class="text-white/80 hover:text-white transition-colors duration-200"
                    >
                      <mat-icon>arrow_back</mat-icon>
                      Back to Blog
                    </button>
                  </nav>

                  <!-- Post Title -->
                  <h1 class="text-3xl md:text-5xl font-bold mb-4 leading-tight">
                    {{ post()!.title }}
                  </h1>

                  <!-- Post Meta -->
                  <div class="flex flex-wrap items-center gap-6 text-white/90">
                    <div class="flex items-center gap-2">
                      <mat-icon class="text-lg">person</mat-icon>
                      <span>{{ post()!.author }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <mat-icon class="text-lg">calendar_today</mat-icon>
                      <span>{{ formatDate(post()!.publisheddate.toString()) }}</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <mat-icon class="text-lg">schedule</mat-icon>
                      <span>{{ getReadingTime(post()!.readtime) }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        } @else {
          <div class="py-16">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
              <!-- Breadcrumb -->
              <nav class="mb-6">
                <button
                  mat-button
                  routerLink="/blog"
                  class="text-white/80 hover:text-white transition-colors duration-200"
                >
                  <mat-icon>arrow_back</mat-icon>
                  Back to Blog
                </button>
              </nav>

              <!-- Post Title -->
              <h1 class="text-3xl md:text-5xl font-bold mb-6 leading-tight">
                {{ post()!.title }}
              </h1>

              <!-- Post Meta -->
              <div class="flex flex-wrap items-center gap-6 text-white/90">
                <div class="flex items-center gap-2">
                  <mat-icon class="text-lg">person</mat-icon>
                  <span>{{ post()!.author }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <mat-icon class="text-lg">calendar_today</mat-icon>
                  <span>{{ formatDate(post()!.publisheddate.toString()) }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <mat-icon class="text-lg">schedule</mat-icon>
                  <span>{{ getReadingTime(post()!.readtime) }}</span>
                </div>
              </div>
            </div>
          </div>
        }
      </div>

      <!-- Main Content -->
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        
        <!-- Tags -->
        @if (post()!.tags.length > 0) {
          <div class="mb-8">
            <div class="flex flex-wrap gap-2">
              @for (tag of post()!.tags; track tag) {
                <mat-chip-set>
                  <mat-chip
                    class="cursor-pointer hover:shadow-md transition-shadow duration-200"
                    (click)="navigateToTagFilter(tag)"
                    [matTooltip]="'View all posts tagged with ' + tag"
                  >
                    {{ tag }}
                  </mat-chip>
                </mat-chip-set>
              }
            </div>
          </div>
        }

        <!-- Post Content -->
        <div class="prose prose-lg max-w-none">
          <div [innerHTML]="sanitizedContent()"></div>
        </div>

        <!-- Post Actions -->
        <mat-divider class="my-12"></mat-divider>
        
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
          <!-- Share Buttons -->
          <div class="flex items-center gap-2">
            <span class="text-sm text-gray-600 mr-2">Share:</span>
            <button
              mat-icon-button
              (click)="shareOnTwitter()"
              matTooltip="Share on Twitter"
              class="text-blue-400 hover:bg-blue-50"
            >
              <mat-icon>share</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="copyLink()"
              matTooltip="Copy link"
              class="text-gray-600 hover:bg-gray-50"
            >
              <mat-icon>link</mat-icon>
            </button>
          </div>

          <!-- Navigation -->
          <div class="flex items-center gap-2">
            <button
              mat-stroked-button
              routerLink="/blog"
              color="primary"
            >
              <mat-icon>arrow_back</mat-icon>
              All Posts
            </button>
          </div>
        </div>

        <!-- Related Posts Section -->
        @if (relatedPosts().length > 0) {
          <mat-divider class="my-12"></mat-divider>
          
          <section>
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Related Articles</h2>
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              @for (relatedPost of relatedPosts(); track relatedPost.slug) {
                <mat-card 
                  class="cursor-pointer hover:shadow-lg transition-shadow duration-300 group"
                  (click)="navigateToPost(relatedPost)"
                >
                  @if (relatedPost.imageurl) {
                    <div class="aspect-video overflow-hidden">
                      <img
                        [src]="relatedPost.imageurl"
                        [alt]="relatedPost.title"
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                        loading="lazy"
                      />
                    </div>
                  }
                  <mat-card-content class="p-4">
                    <h3 class="font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-indigo-600 transition-colors duration-200">
                      {{ relatedPost.title }}
                    </h3>
                    <p class="text-sm text-gray-600 line-clamp-2">
                      {{ relatedPost.excerpt }}
                    </p>
                    <div class="flex items-center justify-between mt-4 text-xs text-gray-500">
                      <span>{{ relatedPost.author }}</span>
                      <span>{{ getReadingTime(relatedPost.readtime) }}</span>
                    </div>
                  </mat-card-content>
                </mat-card>
              }
            </div>
          </section>
        }
      </div>
    }

    <!-- Additional Styling -->
    <style>
      .prose {
        color: #374151;
        line-height: 1.75;
      }
      
      .prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
        color: #111827;
        font-weight: 700;
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      
      .prose h2 {
        font-size: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 0.5rem;
      }
      
      .prose h3 {
        font-size: 1.25rem;
      }
      
      .prose p {
        margin-bottom: 1.25rem;
      }
      
      .prose ul, .prose ol {
        margin: 1.25rem 0;
        padding-left: 1.625rem;
      }
      
      .prose li {
        margin-bottom: 0.5rem;
      }
      
      .prose code {
        color: #e11d48;
        background-color: #f1f5f9;
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-size: 0.875rem;
      }
      
      .prose pre {
        background-color: #1e293b;
        color: #e2e8f0;
        padding: 1.5rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1.5rem 0;
      }
      
      .prose pre code {
        background: none;
        color: inherit;
        padding: 0;
      }
      
      .prose blockquote {
        border-left: 4px solid #6366f1;
        padding-left: 1rem;
        margin: 1.5rem 0;
        font-style: italic;
        color: #6b7280;
      }
      
      .prose a {
        color: #6366f1;
        text-decoration: underline;
      }
      
      .prose a:hover {
        color: #4f46e5;
      }
      
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>
  